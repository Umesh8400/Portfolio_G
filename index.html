<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umesh Joshi | Battery Engineer Portfolio</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #3498db;
            --secondary: #2ecc71; 
            --dark-bg: #0f172a;
            --glass: rgba(15, 23, 42, 0.9);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); }

        body {
            background-color: var(--dark-bg);
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            user-select: none;
        }

        /* --- BACKGROUNDS --- */
        #bg-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            z-index: -3; opacity: 0.2;
        }
        
        /* --- SCREENS --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none;
            transition: opacity 0.8s ease, transform 0.8s ease;
            transform: translateY(20px);
            z-index: 10;
        }
        .screen.active { opacity: 1; pointer-events: all; transform: translateY(0); }

        /* --- SCREEN 1: HELLO --- */
        .hello-cloud { position: relative; width: 90vw; height: 40vh; display: flex; justify-content: center; align-items: center; }
        .w-main { font-size: 5rem; text-shadow: 0 0 20px rgba(255,255,255,0.4); animation: pulse 3s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .welcome-line { margin-top: 2rem; font-size: 1.5rem; border-top: 1px solid white; padding-top: 1rem; }
        .start-btn { margin-top: 30px; padding: 10px 30px; background: rgba(255,255,255,0.1); border: 1px solid white; color: white; cursor: pointer; z-index: 20; transition: 0.3s; }
        .start-btn:hover { background: white; color: var(--dark-bg); }

        /* --- SCREEN 2: LANGUAGES --- */
        .lang-btn { padding: 15px 50px; font-size: 1.5rem; margin: 20px; background: transparent; border: 2px solid white; color: white; cursor: pointer; transition: 0.3s; }
        .lang-btn:hover { background: white; color: var(--primary); transform: scale(1.05); }

        /* --- STANDARD CONTENT SLIDES --- */
        .content-container { display: flex; align-items: center; justify-content: center; max-width: 1200px; padding: 20px; background: var(--glass); border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .side-image { width: 300px; height: auto; margin-right: 40px; border-radius: 10px; }
        .text-content { max-width: 600px; }
        .profile-photo { width: 150px; height: 150px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover; margin-bottom: 20px; }
        h1 { font-size: 2.2rem; margin-bottom: 1rem; } h2 { font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem; }
        p { font-size: 1rem; line-height: 1.5; margin-bottom: 10px; }
        .skills-tag { display: inline-block; padding: 5px 15px; margin: 3px; background: rgba(255,255,255,0.1); border-left: 3px solid var(--primary); font-size: 0.9rem; }

        /* --- MAP CONTAINER --- */
        #map { 
            height: 100vh; 
            width: 100vw; 
            z-index: 1; /* Behind UI */
            filter: brightness(0.8) contrast(1.2); /* Dark Mode Vibe */
        }
        
        /* Map Overlay UI (Experience Cards) */
        .map-overlay-ui {
            position: absolute;
            top: 20%;
            right: 5%;
            width: 350px;
            z-index: 1000; /* Above Map */
            display: flex;
            flex-direction: column;
            gap: 15px;
            pointer-events: none; /* Let clicks pass through to map unless on card */
        }

        .job-card {
            background: var(--glass);
            border: 1px solid rgba(255,255,255,0.2);
            border-left: 5px solid #888;
            padding: 15px;
            border-radius: 8px;
            pointer-events: auto; /* Clickable */
            cursor: pointer;
            transition: all 0.3s ease;
            transform: translateX(50px);
            opacity: 0;
            display: none; /* Hidden by default */
        }

        .job-card.visible { display: block; opacity: 0.9; transform: translateX(0); }
        .job-card.active { opacity: 1; transform: scale(1.02); box-shadow: 0 0 20px rgba(52, 152, 219, 0.4); }
        .job-card:hover { opacity: 1; }

        .job-card h3 { margin: 0; font-size: 1.1rem; color: white; }
        .job-card h4 { margin: 5px 0 10px 0; font-size: 0.85rem; color: #cbd5e1; font-style: italic; }
        .job-card .desc { display: none; font-size: 0.9rem; line-height: 1.4; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px; }
        .job-card.active .desc { display: block; animation: fadeIn 0.5s; }

        .card-elring { border-left-color: var(--secondary); }
        .card-merc { border-left-color: var(--primary); }

        /* Custom Map Marker Icons */
        .custom-icon {
            display: flex; justify-content: center; align-items: center;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .icon-car {
            font-size: 2rem;
            transition: all 0.5s linear;
        }

        /* --- NAVIGATION UI --- */
        .nav-ui { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; z-index: 2000; display: none; }
        .nav-btn { font-size: 1.2rem; font-weight: bold; cursor: pointer; color: white; opacity: 0.8; transition: 0.3s; text-transform: uppercase; background: rgba(0,0,0,0.6); padding: 10px 25px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.3); }
        .nav-btn:hover { opacity: 1; background: var(--primary); border-color: var(--primary); }

    </style>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body onload="initSystem()">

    <div id="bg-image"></div>
    
    <div id="screen-hello" class="screen active">
        <div class="hello-cloud"><span class="w-main">Hello</span></div>
        <div class="welcome-line">My Battery Engineering Portfolio</div>
        <button class="start-btn" onclick="goToLanguages()">Start &#8594;</button>
    </div>

    <div id="screen-lang" class="screen">
        <h2>Select Language</h2>
        <div>
            <button class="lang-btn" onclick="selectLang('en')">English</button>
            <button class="lang-btn" onclick="selectLang('de')">Deutsch</button>
        </div>
    </div>

    <div id="screen-map" class="screen" style="opacity: 0; pointer-events: none;">
        <div id="map"></div>
        
        <div class="map-overlay-ui" id="map-ui">
            <div id="card-ek-1" class="job-card card-elring" onclick="toggleCard(this)">
                <h3 id="t-ek1">Internship</h3>
                <h4 id="d-ek1">05.2023 â€“ 11.2023</h4>
                <div class="desc" id="desc-ek1">...</div>
            </div>
            <div id="card-ek-2" class="job-card card-elring" onclick="toggleCard(this)">
                <h3 id="t-ek2">Working Student</h3>
                <h4 id="d-ek2">11.2023 â€“ 01.2024</h4>
                <div class="desc" id="desc-ek2">...</div>
            </div>

            <div id="card-mb-1" class="job-card card-merc" onclick="toggleCard(this)">
                <h3 id="t-mb1">Working Student</h3>
                <h4 id="d-mb1">02.2024 â€“ 11.2024</h4>
                <div class="desc" id="desc-mb1">...</div>
            </div>
            <div id="card-mb-2" class="job-card card-merc" onclick="toggleCard(this)">
                <h3 id="t-mb2">Master Thesis</h3>
                <h4 id="d-mb2">12.2024 â€“ 07.2025</h4>
                <div class="desc" id="desc-mb2">...</div>
            </div>
            <div id="card-mb-3" class="job-card card-merc" onclick="toggleCard(this)">
                <h3 id="t-mb3">Working Student (Current)</h3>
                <h4 id="d-mb3">08.2025 â€“ Ongoing</h4>
                <div class="desc" id="desc-mb3">...</div>
            </div>
        </div>
    </div>

    <div id="screen-content" class="screen">
        </div>

    <div id="global-nav" class="nav-ui">
        <div class="nav-btn" onclick="goBack()">&#8592; Back</div>
        <div class="nav-btn" onclick="goNext()">Next &#8594;</div>
    </div>

    <script>
        // --- DATA & TEXTS ---
        const texts = {
            en: {
                ek1: { t:"Internship", d:"05.2023 â€“ 11.2023", desc:"â€¢ Battery System Tests & Validation<br>â€¢ Impedance measurements<br>â€¢ Test protocols" },
                ek2: { t:"Working Student", d:"11.2023 â€“ 01.2024", desc:"â€¢ Testing battery components<br>â€¢ Evaluating results (X-Frame)<br>â€¢ Hardware design" },
                mb1: { t:"Working Student (HV Battery)", d:"02.2024 â€“ 11.2024", desc:"â€¢ MATLAB automation (95% saved)<br>â€¢ 3D Simulation (CST)<br>â€¢ Impedance measurements" },
                mb2: { t:"Master Thesis", d:"12.2024 â€“ 07.2025", desc:"â€¢ Voltage Relaxation Modeling (Grade 1.0)<br>â€¢ Python Optimization<br>â€¢ SOC estimation accuracy" },
                mb3: { t:"Working Student (Current)", d:"08.2025 â€“ Ongoing", desc:"â€¢ Machine Learning predictive analysis<br>â€¢ Anomaly datasets<br>â€¢ Fundamental research" }
            },
            de: {
                ek1: { t:"Praktikant", d:"05.2023 â€“ 11.2023", desc:"â€¢ Batterie-Systemtests & Validierung<br>â€¢ Impedanzmessungen<br>â€¢ Testprotokolle" },
                ek2: { t:"Werkstudent", d:"11.2023 â€“ 01.2024", desc:"â€¢ Testen von Batteriekomponenten<br>â€¢ Auswertung (X-Frame)<br>â€¢ Hardware-Design" },
                mb1: { t:"Werkstudent (HV Batterie)", d:"02.2024 â€“ 11.2024", desc:"â€¢ MATLAB-Automatisierung<br>â€¢ 3D-Simulation (CST)<br>â€¢ Impedanzmessungen" },
                mb2: { t:"Masterarbeit", d:"12.2024 â€“ 07.2025", desc:"â€¢ Spannungsrelaxationsmodellierung (1.0)<br>â€¢ Python-Optimierung<br>â€¢ SOC-SchÃ¤tzung" },
                mb3: { t:"Werkstudent (Aktuell)", d:"08.2025 â€“ Laufend", desc:"â€¢ Machine Learning Analyse<br>â€¢ Anomalie-DatensÃ¤tze<br>â€¢ Grundlagenforschung" }
            }
        };

        const slidesData = {
            en: [
                { type: 'title', title: "EDUCATION" },
                { type: 'content', title: "Hochschule Stralsund", role: "Master M.Eng.", details: "Renewable Energies & E-Mobility" },
                { type: 'content', title: "University of Mumbai", role: "Bachelor B.E.", details: "Electrical Engineering" },
                { type: 'title', title: "SKILLS" },
                { type: 'skills', list: ["MATLAB", "Python", "Simulink", "CANoe", "Machine Learning"] },
                { type: 'end', title: "Thank You" }
            ],
            de: [
                { type: 'title', title: "AUSBILDUNG" },
                { type: 'content', title: "Hochschule Stralsund", role: "Master M.Eng.", details: "Erneuerbare Energien & E-MobilitÃ¤t" },
                { type: 'content', title: "University of Mumbai", role: "Bachelor B.E.", details: "Elektrotechnik" },
                { type: 'title', title: "KENNTNISSE" },
                { type: 'skills', list: ["MATLAB", "Python", "Simulink", "CANoe", "Machine Learning"] },
                { type: 'end', title: "Vielen Dank" }
            ]
        };

        // --- GLOBAL VARS ---
        let map, carMarker, routeLine;
        let currentLang = 'en';
        let appState = 0; // 0:Hello, 1:Lang, 2:Map, 3:Slides
        let mapStep = 0; // 0:Zoom, 1:ShowEk, 2:Drive, 3:ShowMb, 4:Done
        let slideIndex = 0;

        // COORDINATES
        const coords = {
            neuffen: [48.5546, 9.2248], // ElringKlinger
            unterturkheim: [48.7775, 9.2354], // Mercedes
            centerStart: [50.0, 10.0] // Zoomed out Europe
        };

        // --- INIT ---
        function initSystem() {
            // Nothing to do until user clicks start
        }

        // --- NAVIGATION FLOW ---
        function goToLanguages() {
            appState = 1;
            switchScreen('screen-hello', 'screen-lang');
        }

        function selectLang(lang) {
            currentLang = lang;
            fillMapTexts();
            appState = 2; // Go to Map
            switchScreen('screen-lang', 'screen-map');
            document.getElementById('global-nav').style.display = 'flex';
            
            // Initialize Map after delay (so div is visible)
            setTimeout(initMap, 500);
        }

        function goNext() {
            if (appState === 0) goToLanguages();
            else if (appState === 1) return; // User must pick lang
            else if (appState === 2) {
                // MAP LOGIC SEQUENCE
                if (mapStep === 0) {
                    // Zoom In
                    map.flyTo(coords.neuffen, 13, { duration: 2 });
                    setTimeout(() => {
                        document.getElementById('card-ek-1').classList.add('visible', 'active');
                        mapStep = 1;
                    }, 2500);
                } else if (mapStep === 1) {
                    // Show 2nd Elring Card
                    document.getElementById('card-ek-1').classList.remove('active');
                    document.getElementById('card-ek-2').classList.add('visible', 'active');
                    mapStep = 2;
                } else if (mapStep === 2) {
                    // Drive to Mercedes
                    document.getElementById('card-ek-2').classList.remove('active');
                    startDrivingAnim();
                    mapStep = 3;
                } else if (mapStep === 3) {
                    // Cycle through Mercedes Cards
                    const c1 = document.getElementById('card-mb-1');
                    const c2 = document.getElementById('card-mb-2');
                    const c3 = document.getElementById('card-mb-3');
                    
                    if (!c1.classList.contains('visible')) {
                        c1.classList.add('visible', 'active');
                    } else if (c1.classList.contains('active')) {
                        c1.classList.remove('active');
                        c2.classList.add('visible', 'active');
                    } else if (c2.classList.contains('active')) {
                        c2.classList.remove('active');
                        c3.classList.add('visible', 'active');
                        mapStep = 4; // Map done
                    }
                } else {
                    // Leave Map -> Go to Slides
                    appState = 3;
                    slideIndex = 0;
                    renderSlide();
                    switchScreen('screen-map', 'screen-content');
                }
            } else if (appState === 3) {
                // SLIDES LOGIC
                slideIndex++;
                if (slideIndex >= slidesData[currentLang].length) slideIndex = 0;
                renderSlide();
            }
        }

        function goBack() {
            if (appState <= 1) return;
            // Simplified Back Logic for demo
            location.reload(); 
        }

        // --- MAP FUNCTIONS ---
        function initMap() {
            // Create Leaflet Map
            map = L.map('map', { zoomControl: false }).setView(coords.centerStart, 5);

            // Add Dark Mode Tiles (CartoDB DarkMatter)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; OpenStreetMap &copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);

            // Add Custom Markers
            const elringIcon = L.divIcon({ className: 'custom-icon', html: 'ðŸ­', iconSize: [40, 40] });
            const mercIcon = L.divIcon({ className: 'custom-icon', html: 'ðŸ¢', iconSize: [40, 40] });
            const carIcon = L.divIcon({ className: 'custom-icon icon-car', html: 'ðŸš—', iconSize: [50, 50] });

            L.marker(coords.neuffen, { icon: elringIcon }).addTo(map).bindPopup("ElringKlinger AG");
            L.marker(coords.unterturkheim, { icon: mercIcon }).addTo(map).bindPopup("Mercedes-Benz AG");

            // Prepare Car Marker (Hidden initially)
            carMarker = L.marker(coords.neuffen, { icon: carIcon, opacity: 0 }).addTo(map);
        }

        function startDrivingAnim() {
            // Draw Route Line
            const latlngs = [coords.neuffen, coords.unterturkheim];
            routeLine = L.polyline(latlngs, { color: '#3498db', weight: 5, dashArray: '10, 10', opacity: 0.7 }).addTo(map);
            
            // Zoom to fit route
            map.flyToBounds(L.latLngBounds(latlngs), { padding: [50, 50], duration: 1.5 });

            // Animate Car
            setTimeout(() => {
                carMarker.setOpacity(1);
                let start = coords.neuffen;
                let end = coords.unterturkheim;
                let steps = 100;
                let stepCount = 0;

                let interval = setInterval(() => {
                    stepCount++;
                    let lat = start[0] + (end[0] - start[0]) * (stepCount / steps);
                    let lng = start[1] + (end[1] - start[1]) * (stepCount / steps);
                    carMarker.setLatLng([lat, lng]);

                    if (stepCount >= steps) {
                        clearInterval(interval);
                        // Arrived
                        document.getElementById('card-mb-1').classList.add('visible', 'active');
                    }
                }, 20); // Speed
            }, 2000);
        }

        // --- UI HELPERS ---
        function switchScreen(fromId, toId) {
            document.getElementById(fromId).classList.remove('active');
            setTimeout(() => {
                // If switching away from map, hide it specifically to allow clicks elsewhere
                if(fromId === 'screen-map') document.getElementById('screen-map').style.pointerEvents = 'none';
                
                const toEl = document.getElementById(toId);
                toEl.style.opacity = 1;
                toEl.style.pointerEvents = 'all';
                toEl.classList.add('active');
            }, 500);
        }

        function toggleCard(card) {
            // Accordion click
            if(card.classList.contains('active')) {
                card.classList.remove('active');
            } else {
                document.querySelectorAll('.job-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
            }
        }

        function fillMapTexts() {
            const t = texts[currentLang];
            // Ek
            document.getElementById('t-ek1').innerText = t.ek1.t; document.getElementById('d-ek1').innerText = t.ek1.d; document.getElementById('desc-ek1').innerHTML = t.ek1.desc;
            document.getElementById('t-ek2').innerText = t.ek2.t; document.getElementById('d-ek2').innerText = t.ek2.d; document.getElementById('desc-ek2').innerHTML = t.ek2.desc;
            // Mb
            document.getElementById('t-mb1').innerText = t.mb1.t; document.getElementById('d-mb1').innerText = t.mb1.d; document.getElementById('desc-mb1').innerHTML = t.mb1.desc;
            document.getElementById('t-mb2').innerText = t.mb2.t; document.getElementById('d-mb2').innerText = t.mb2.d; document.getElementById('desc-mb2').innerHTML = t.mb2.desc;
            document.getElementById('t-mb3').innerText = t.mb3.t; document.getElementById('d-mb3').innerText = t.mb3.d; document.getElementById('desc-mb3').innerHTML = t.mb3.desc;
        }

        function renderSlide() {
            const slide = slidesData[currentLang][slideIndex];
            const contentDiv = document.getElementById('screen-content');
            
            let html = '<div class="content-container"><div class="text-content" style="text-align:center">';
            
            if (slide.type === 'title' || slide.type === 'end') {
                html += `<h1>${slide.title}</h1>`;
            } else if (slide.type === 'content') {
                html += `<h2>${slide.title}</h2><h3>${slide.role}</h3><p>${slide.details}</p>`;
            } else if (slide.type === 'skills') {
                html += `<h2>Skills</h2><div>${slide.list.map(s => `<span class="skills-tag">${s}</span>`).join('')}</div>`;
            }
            
            html += '</div></div>';
            contentDiv.innerHTML = html;
        }
        
        // Keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === "ArrowRight") goNext();
        });
    </script>
</body>
</html>
